<!-- diary.wxml -->
<view class="container">
  <view class="header">
    <text class="title">记住每天</text>
    <text class="date">{{currentDate}}</text>
  </view>

  <view class="diary-list" wx:if="{{diaries.length > 0}}">
    <view class="diary-item" wx:for="{{diaries}}" wx:key="id">
      <view class="diary-content">
        <text class="diary-text">{{item.text}}</text>
        
        <!-- 媒体展示 -->
        <view class="media-container" wx:if="{{item.media.length > 0}}">
          <block wx:for="{{item.media}}" wx:for-item="media" wx:key="*this">
            <!-- 图片 -->
            <image 
              wx:if="{{media.type === 'image'}}"
              src="{{media.url}}"
              mode="aspectFill"
              class="media-image"
              bindtap="previewImage"
              data-urls="{{item.media}}"
              data-current="{{media.url}}"
            />
            <!-- 视频 -->
            <video 
              wx:if="{{media.type === 'video'}}"
              src="{{media.url}}"
              class="media-video"
              controls
            />
          </block>
        </view>

        <!-- 语音播放器 -->
        <view class="audio-player" wx:if="{{item.audio}}">
          <view class="audio-content">
            <image class="audio-icon" src="/images/audio.png" bindtap="playAudio" data-src="{{item.audio}}"/>
            <text class="audio-duration">{{item.audioDuration}}s</text>
          </view>
        </view>

        <text class="diary-time">{{item.time}}</text>
      </view>
    </view>
  </view>

  <view class="empty-state" wx:else>
    <text>今天还没有记录哦~</text>
  </view>

  <view class="add-button" bindtap="showAddModal">
    <text class="add-icon">+</text>
  </view>

  <!-- 添加日记的模态框 -->
  <view class="modal" wx:if="{{showModal}}" bindtap="hideModal">
    <view class="modal-content" catchtap="preventBubble">
      <view class="modal-header">
        <text class="modal-title">添加记录</text>
        <text class="close-btn" bindtap="hideModal">×</text>
      </view>

      <view class="modal-body">
        <textarea 
          class="diary-input" 
          placeholder="写下此刻的想法..."
          bindinput="onTextInput"
          value="{{newDiary.text}}"
        />

        <view class="toolbar">
          <view class="tool-item" bindtap="chooseMedia">
            
            <text class="add-icon">@</text>
          </view>
          <view class="tool-item" bindtap="startVoiceInput">
            
            <text class="add-icon">#</text>
          </view>
        </view>

        <!-- 媒体预览 -->
        <view class="preview-container" wx:if="{{newDiary.media.length > 0}}">
          <block wx:for="{{newDiary.media}}" wx:key="*this">
            <image 
              wx:if="{{item.type === 'image'}}"
              src="{{item.url}}"
              mode="aspectFill"
              class="preview-image"
              bindtap="previewImage"
              data-urls="{{newDiary.media}}"
              data-current="{{item.url}}"
            />
            <video 
              wx:if="{{item.type === 'video'}}"
              src="{{item.url}}"
              class="preview-video"
              controls
            />
          </block>
        </view>

        <!-- 语音输入状态 -->
        <view class="voice-input-status" wx:if="{{isRecording}}">
          <view class="voice-wave">
            <view class="wave-bar" wx:for="{{8}}" wx:key="*this" style="height: {{voiceWaveHeight}}rpx"></view>
          </view>
          <text class="recording-time">{{recordingTime}}s</text>
        </view>
      </view>

      <view class="modal-footer">
        <button class="save-btn" bindtap="saveDiary">保存</button>
      </view>
    </view>
  </view>
</view> 